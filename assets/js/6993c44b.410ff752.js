"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5236],{3905:function(e,n,r){r.d(n,{Zo:function(){return d},kt:function(){return g}});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=t.createContext({}),s=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},d=function(e){var n=s(e.components);return t.createElement(i.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),m=s(r),g=o,f=m["".concat(i,".").concat(g)]||m[g]||k[g]||a;return r?t.createElement(f,l(l({ref:n},d),{},{components:r})):t.createElement(f,l({ref:n},d))}));function g(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=m;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c.mdxType="string"==typeof e?e:o,l[1]=c;for(var s=2;s<a;s++)l[s]=r[s];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6940:function(e,n,r){r.r(n),r.d(n,{assets:function(){return d},contentTitle:function(){return i},default:function(){return g},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return k}});var t=r(7462),o=r(3366),a=(r(7294),r(3905)),l=["components"],c={"\u6982\u8ff0":"\u7528Go\u8bfb\u53d60x Protocol\u667a\u80fd\u5408\u7ea6\u4e8b\u4ef6\u65e5\u5fd7\u7684\u6559\u7a0b"},i="\u8bfb\u53d60x Protocol\u4e8b\u4ef6\u65e5\u5fd7",s={unversionedId:"zh/event-read-0xprotocol/README",id:"zh/event-read-0xprotocol/README",title:"\u8bfb\u53d60x Protocol\u4e8b\u4ef6\u65e5\u5fd7",description:"\u8981\u8bfb\u53d60x Protocol\u4e8b\u4ef6\u65e5\u5fd7\uff0c\u6211\u4eec\u5fc5\u987b\u9996\u5148\u5c06solidity\u667a\u80fd\u5408\u7ea6\u7f16\u8bd1\u4e3a\u4e00\u4e2aGo\u5305\u3002",source:"@site/docs/zh/event-read-0xprotocol/README.md",sourceDirName:"zh/event-read-0xprotocol",slug:"/zh/event-read-0xprotocol/",permalink:"/ethereum-development-with-go-book/docs/zh/event-read-0xprotocol/",editUrl:"https://github.com/mhxw/ethereum-development-with-go-book/tree/dev/docs/zh/event-read-0xprotocol/README.md",tags:[],version:"current",frontMatter:{"\u6982\u8ff0":"\u7528Go\u8bfb\u53d60x Protocol\u667a\u80fd\u5408\u7ea6\u4e8b\u4ef6\u65e5\u5fd7\u7684\u6559\u7a0b"},sidebar:"zh",previous:{title:"\u8bfb\u53d6ERC-20\u4ee3\u5e01\u7684\u4e8b\u4ef6\u65e5\u5fd7",permalink:"/ethereum-development-with-go-book/docs/zh/event-read-erc20/"},next:{title:"\u7b7e\u540d",permalink:"/ethereum-development-with-go-book/docs/zh/signatures/"}},d={},k=[{value:"\u5b8c\u6574\u4ee3\u7801",id:"\u5b8c\u6574\u4ee3\u7801",level:3}],m={toc:k};function g(e){var n=e.components,r=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,t.Z)({},m,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u8bfb\u53d60x-protocol\u4e8b\u4ef6\u65e5\u5fd7"},"\u8bfb\u53d60x Protocol\u4e8b\u4ef6\u65e5\u5fd7"),(0,a.kt)("p",null,"\u8981\u8bfb\u53d6",(0,a.kt)("a",{parentName:"p",href:"https://0xproject.com/"},"0x Protocol"),"\u4e8b\u4ef6\u65e5\u5fd7\uff0c\u6211\u4eec\u5fc5\u987b\u9996\u5148\u5c06solidity\u667a\u80fd\u5408\u7ea6\u7f16\u8bd1\u4e3a\u4e00\u4e2aGo\u5305\u3002"),(0,a.kt)("p",null,"\u5b89\u88c5solc\u7248\u672c",(0,a.kt)("inlineCode",{parentName:"p"},"0.4.11")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -g solc@0.4.11\n")),(0,a.kt)("p",null,"\u4e3a\u4f8b\u5982",(0,a.kt)("inlineCode",{parentName:"p"},"Exchange.sol"),"\u7684\u4e8b\u4ef6\u65e5\u5fd7\u521b\u5efa0x Protocol\u4ea4\u6613\u6240\u667a\u80fd\u5408\u7ea6\u63a5\u53e3:"),(0,a.kt)("p",null,"Create the 0x protocol exchange smart contract interface for event logs as ",(0,a.kt)("inlineCode",{parentName:"p"},"Exchange.sol"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-solidity"},"pragma solidity 0.4.11;\n\ncontract Exchange {\n    event LogFill(\n        address indexed maker,\n        address taker,\n        address indexed feeRecipient,\n        address makerToken,\n        address takerToken,\n        uint filledMakerTokenAmount,\n        uint filledTakerTokenAmount,\n        uint paidMakerFee,\n        uint paidTakerFee,\n        bytes32 indexed tokens, // keccak256(makerToken, takerToken), allows subscribing to a token pair\n        bytes32 orderHash\n    );\n\n    event LogCancel(\n        address indexed maker,\n        address indexed feeRecipient,\n        address makerToken,\n        address takerToken,\n        uint cancelledMakerTokenAmount,\n        uint cancelledTakerTokenAmount,\n        bytes32 indexed tokens,\n        bytes32 orderHash\n    );\n\n    event LogError(uint8 indexed errorId, bytes32 indexed orderHash);\n}\n")),(0,a.kt)("p",null,"\u63a5\u7740\u7ed9\u5b9aabi\uff0c\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"abigen"),"\u6765\u521b\u5efaGo",(0,a.kt)("inlineCode",{parentName:"p"},"exchange"),"\u5305\uff1a"),(0,a.kt)("p",null,"Then use ",(0,a.kt)("inlineCode",{parentName:"p"},"abigen")," to create the Go ",(0,a.kt)("inlineCode",{parentName:"p"},"exchange")," package given the abi:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'solc --abi Exchange.sol\nabigen --abi="Exchange.sol:Exchange.abi" --pkg=exchange --out=Exchange.go\n')),(0,a.kt)("p",null,"\u73b0\u5728\u5728\u6211\u4eec\u7684Go\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u8ba9\u6211\u4eec\u521b\u5efa\u4e0e0xProtocol\u4e8b\u4ef6\u65e5\u5fd7\u7b7e\u540d\u7c7b\u578b\u5339\u914d\u7684\u7ed3\u6784\u4f53\u7c7b\u578b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"type LogFill struct {\n    Maker                  common.Address\n    Taker                  common.Address\n    FeeRecipient           common.Address\n    MakerToken             common.Address\n    TakerToken             common.Address\n    FilledMakerTokenAmount *big.Int\n    FilledTakerTokenAmount *big.Int\n    PaidMakerFee           *big.Int\n    PaidTakerFee           *big.Int\n    Tokens                 [32]byte\n    OrderHash              [32]byte\n}\n\ntype LogCancel struct {\n    Maker                     common.Address\n    FeeRecipient              common.Address\n    MakerToken                common.Address\n    TakerToken                common.Address\n    CancelledMakerTokenAmount *big.Int\n    CancelledTakerTokenAmount *big.Int\n    Tokens                    [32]byte\n    OrderHash                 [32]byte\n}\n\ntype LogError struct {\n    ErrorID   uint8\n    OrderHash [32]byte\n}\n")),(0,a.kt)("p",null,"\u521d\u59cb\u5316\u4ee5\u592a\u574a\u5ba2\u6237\u7aef\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'client, err := ethclient.Dial("https://cloudflare-eth.com")\nif err != nil {\n  log.Fatal(err)\n}\n')),(0,a.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"p"},"FilterQuery"),"\uff0c\u5e76\u4e3a\u5176\u4f20\u90120x Protocol\u667a\u80fd\u5408\u7ea6\u5730\u5740\u548c\u6240\u9700\u7684\u533a\u5757\u8303\u56f4\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// 0x Protocol Exchange smart contract address\ncontractAddress := common.HexToAddress("0x12459C951127e0c374FF9105DdA097662A027093")\nquery := ethereum.FilterQuery{\n  FromBlock: big.NewInt(6383482),\n  ToBlock:   big.NewInt(6383488),\n  Addresses: []common.Address{\n    contractAddress,\n  },\n}\n')),(0,a.kt)("p",null,"\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"FilterLogs"),"\u67e5\u8be2\u65e5\u5fd7\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"logs, err := client.FilterLogs(context.Background(), query)\nif err != nil {\n  log.Fatal(err)\n}\n")),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u89e3\u6790JSON abi\uff0c\u6211\u4eec\u540e\u7eed\u5c06\u4f7f\u7528\u89e3\u538b\u7f29\u539f\u59cb\u65e5\u5fd7\u6570\u636e\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"contractAbi, err := abi.JSON(strings.NewReader(string(exchange.ExchangeABI)))\nif err != nil {\n  log.Fatal(err)\n}\n")),(0,a.kt)("p",null,"\u4e3a\u4e86\u6309\u67d0\u79cd\u65e5\u5fd7\u7c7b\u578b\u8fc7\u6ee4\uff0c\u6211\u4eec\u9700\u8981\u77e5\u6653\u6bcf\u4e2a\u4e8b\u4ef6\u65e5\u5fd7\u51fd\u6570\u7b7e\u540d\u7684keccak256\u6458\u8981\u3002\u6b63\u5982\u6211\u4eec\u5f88\u5feb\u6240\u89c1\u5230\u7684\u90a3\u6837\uff0c\u4e8b\u4ef6\u65e5\u5fd7\u51fd\u6570\u7b7e\u540d\u6458\u8981\u603b\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"topic[0]"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// NOTE: keccak256("LogFill(address,address,address,address,address,uint256,uint256,uint256,uint256,bytes32,bytes32)")\nlogFillEvent := common.HexToHash("0d0b9391970d9a25552f37d436d2aae2925e2bfe1b2a923754bada030c498cb3")\n\n// NOTE: keccak256("LogCancel(address,address,address,address,uint256,uint256,bytes32,bytes32)")\nlogCancelEvent := common.HexToHash("67d66f160bc93d925d05dae1794c90d2d6d6688b29b84ff069398a9b04587131")\n\n// NOTE: keccak256("LogError(uint8,bytes32)")\nlogErrorEvent := common.HexToHash("36d86c59e00bd73dc19ba3adfe068e4b64ac7e92be35546adeddf1b956a87e90")\n')),(0,a.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u8fed\u4ee3\u6240\u6709\u7684\u65e5\u5fd7\u5e76\u8bbe\u7f6e\u4e00\u4e2aswitch\u8bed\u53e5\u6765\u6309\u4e8b\u4ef6\u65e5\u5fd7\u7c7b\u578b\u8fc7\u6ee4\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'for _, vLog := range logs {\n  fmt.Printf("Log Block Number: %d\\n", vLog.BlockNumber)\n  fmt.Printf("Log Index: %d\\n", vLog.Index)\n\n  switch vLog.Topics[0].Hex() {\n  case logFillEvent.Hex():\n    //\n  case logCancelEvent.Hex():\n    //\n  case logErrorEvent.Hex():\n    //\n  }\n}\n')),(0,a.kt)("p",null,"\u73b0\u5728\u8981\u89e3\u6790",(0,a.kt)("inlineCode",{parentName:"p"},"LogFill"),"\uff0c\u6211\u4eec\u5c06\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"abi.Unpack"),"\u5c06\u539f\u59cb\u6570\u636e\u7c7b\u578b\u89e3\u6790\u4e3a\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u7c7b\u578b\u7ed3\u6784\u4f53\u3002Unpack\u4e0d\u4f1a\u89e3\u6790",(0,a.kt)("inlineCode",{parentName:"p"},"indexed"),"\u4e8b\u4ef6\u7c7b\u578b\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5b83\u4eec\u5b58\u50a8\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"topics"),"\u4e0b\uff0c\u6240\u4ee5\u5bf9\u4e8e\u90a3\u4e9b\u6211\u4eec\u5fc5\u987b\u5355\u72ec\u89e3\u6790\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'fmt.Printf("Log Name: LogFill\\n")\n\nvar fillEvent LogFill\n\nerr := contractAbi.Unpack(&fillEvent, "LogFill", vLog.Data)\nif err != nil {\n  log.Fatal(err)\n}\n\nfillEvent.Maker = common.HexToAddress(vLog.Topics[1].Hex())\nfillEvent.FeeRecipient = common.HexToAddress(vLog.Topics[2].Hex())\nfillEvent.Tokens = vLog.Topics[3]\n\nfmt.Printf("Maker: %s\\n", fillEvent.Maker.Hex())\nfmt.Printf("Taker: %s\\n", fillEvent.Taker.Hex())\nfmt.Printf("Fee Recipient: %s\\n", fillEvent.FeeRecipient.Hex())\nfmt.Printf("Maker Token: %s\\n", fillEvent.MakerToken.Hex())\nfmt.Printf("Taker Token: %s\\n", fillEvent.TakerToken.Hex())\nfmt.Printf("Filled Maker Token Amount: %s\\n", fillEvent.FilledMakerTokenAmount.String())\nfmt.Printf("Filled Taker Token Amount: %s\\n", fillEvent.FilledTakerTokenAmount.String())\nfmt.Printf("Paid Maker Fee: %s\\n", fillEvent.PaidMakerFee.String())\nfmt.Printf("Paid Taker Fee: %s\\n", fillEvent.PaidTakerFee.String())\nfmt.Printf("Tokens: %s\\n", hexutil.Encode(fillEvent.Tokens[:]))\nfmt.Printf("Order Hash: %s\\n", hexutil.Encode(fillEvent.OrderHash[:]))\n')),(0,a.kt)("p",null,"\u5bf9\u4e8e",(0,a.kt)("inlineCode",{parentName:"p"},"LogCancel"),"\u7c7b\u4f3c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'fmt.Printf("Log Name: LogCancel\\n")\n\nvar cancelEvent LogCancel\n\nerr := contractAbi.Unpack(&cancelEvent, "LogCancel", vLog.Data)\nif err != nil {\n  log.Fatal(err)\n}\n\ncancelEvent.Maker = common.HexToAddress(vLog.Topics[1].Hex())\ncancelEvent.FeeRecipient = common.HexToAddress(vLog.Topics[2].Hex())\ncancelEvent.Tokens = vLog.Topics[3]\n\nfmt.Printf("Maker: %s\\n", cancelEvent.Maker.Hex())\nfmt.Printf("Fee Recipient: %s\\n", cancelEvent.FeeRecipient.Hex())\nfmt.Printf("Maker Token: %s\\n", cancelEvent.MakerToken.Hex())\nfmt.Printf("Taker Token: %s\\n", cancelEvent.TakerToken.Hex())\nfmt.Printf("Cancelled Maker Token Amount: %s\\n", cancelEvent.CancelledMakerTokenAmount.String())\nfmt.Printf("Cancelled Taker Token Amount: %s\\n", cancelEvent.CancelledTakerTokenAmount.String())\nfmt.Printf("Tokens: %s\\n", hexutil.Encode(cancelEvent.Tokens[:]))\nfmt.Printf("Order Hash: %s\\n", hexutil.Encode(cancelEvent.OrderHash[:]))\n')),(0,a.kt)("p",null,"\u6700\u540e\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"LogError"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'fmt.Printf("Log Name: LogError\\n")\n\nerrorID, err := strconv.ParseInt(vLog.Topics[1].Hex(), 16, 64)\nif err != nil {\n  log.Fatal(err)\n}\n\nerrorEvent := &LogError{\n  ErrorID:   uint8(errorID),\n  OrderHash: vLog.Topics[2],\n}\n\nfmt.Printf("Error ID: %d\\n", errorEvent.ErrorID)\nfmt.Printf("Order Hash: %s\\n", hexutil.Encode(errorEvent.OrderHash[:]))\n')),(0,a.kt)("p",null,"\u5c06\u5b83\u4eec\u653e\u5728\u4e00\u8d77\u5e76\u8fd0\u884c\u6211\u4eec\u5c06\u770b\u5230\u4ee5\u4e0b\u8f93\u51fa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Log Block Number: 6383482\nLog Index: 35\nLog Name: LogFill\nMaker: 0x8dd688660ec0BaBD0B8a2f2DE3232645F73cC5eb\nTaker: 0xe269E891A2Ec8585a378882fFA531141205e92E9\nFee Recipient: 0xe269E891A2Ec8585a378882fFA531141205e92E9\nMaker Token: 0xD7732e3783b0047aa251928960063f863AD022D8\nTaker Token: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\nFilled Maker Token Amount: 240000000000000000000000\nFilled Taker Token Amount: 6930282000000000000\nPaid Maker Fee: 0\nPaid Taker Fee: 0\nTokens: 0xf08499c9e419ea8c08c4b991f88632593fb36baf4124c62758acb21898711088\nOrder Hash: 0x306a9a7ecbd9446559a2c650b4cfc16d1fb615aa2b3f4f63078da6d021268440\n\n\nLog Block Number: 6383482\nLog Index: 38\nLog Name: LogFill\nMaker: 0x04aa059b2e31B5898fAB5aB24761e67E8a196AB8\nTaker: 0xe269E891A2Ec8585a378882fFA531141205e92E9\nFee Recipient: 0xe269E891A2Ec8585a378882fFA531141205e92E9\nMaker Token: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\nTaker Token: 0xD7732e3783b0047aa251928960063f863AD022D8\nFilled Maker Token Amount: 6941718000000000000\nFilled Taker Token Amount: 240000000000000000000000\nPaid Maker Fee: 0\nPaid Taker Fee: 0\nTokens: 0x97ef123f2b566f36ab1e6f5d462a8079fbe34fa667b4eae67194b3f9cce60f2a\nOrder Hash: 0xac270e88ce27b6bb78ee5b68ebaef666a77195020a6ab8922834f07bc9e0d524\n\n\nLog Block Number: 6383488\nLog Index: 43\nLog Name: LogCancel\nMaker: 0x0004E79C978B95974dCa16F56B516bE0c50CC652\nFee Recipient: 0xA258b39954ceF5cB142fd567A46cDdB31a670124\nMaker Token: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\nTaker Token: 0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359\nCancelled Maker Token Amount: 30000000000000000000\nCancelled Taker Token Amount: 7274848425000000000000\nTokens: 0x9dd48110dcc444fdc242510c09bbbbe21a5975cac061d82f7b843bce061ba391\nOrder Hash: 0xe43eff38dc27af046bfbd431926926c072bbc7a509d56f6f1a7ae1f5ad7efe4f\n")),(0,a.kt)("p",null,"\u5c06\u89e3\u6790\u540e\u7684\u65e5\u5fd7\u8f93\u51fa\u4e0eetherscan\u4e0a\u7684\u5185\u5bb9\u8fdb\u884c\u6bd4\u8f83\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://etherscan.io/tx/0xb73a4492c5db1f67930b25ce3869c1e6b9bdbccb239a23b6454925a5bc0e03c5"},"https://etherscan.io/tx/0xb73a4492c5db1f67930b25ce3869c1e6b9bdbccb239a23b6454925a5bc0e03c5")),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"\u5b8c\u6574\u4ee3\u7801"},"\u5b8c\u6574\u4ee3\u7801"),(0,a.kt)("p",null,"\u547d\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'solc --abi Exchange.sol\nabigen --abi="Exchange.sol:Exchange.abi" --pkg=exchange --out=Exchange.go\n')),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/mhxw/ethereum-development-with-go-book/blob/main/code/contracts_0xprotocol/Exchange.sol"},"Exchange.sol")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-solidity"},"pragma solidity 0.4.11;\n\ncontract Exchange {\n    event LogFill(\n        address indexed maker,\n        address taker,\n        address indexed feeRecipient,\n        address makerToken,\n        address takerToken,\n        uint filledMakerTokenAmount,\n        uint filledTakerTokenAmount,\n        uint paidMakerFee,\n        uint paidTakerFee,\n        bytes32 indexed tokens, // keccak256(makerToken, takerToken), allows subscribing to a token pair\n        bytes32 orderHash\n    );\n\n    event LogCancel(\n        address indexed maker,\n        address indexed feeRecipient,\n        address makerToken,\n        address takerToken,\n        uint cancelledMakerTokenAmount,\n        uint cancelledTakerTokenAmount,\n        bytes32 indexed tokens,\n        bytes32 orderHash\n    );\n\n    event LogError(uint8 indexed errorId, bytes32 indexed orderHash);\n}\n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/mhxw/ethereum-development-with-go-book/blob/main/code/event_read.go"},"event_read_0xprotocol.go")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "context"\n    "fmt"\n    "log"\n    "math/big"\n    "strconv"\n    "strings"\n\n    exchange "./contracts_0xprotocol" // for demo\n    "github.com/ethereum/go-ethereum"\n    "github.com/ethereum/go-ethereum/accounts/abi"\n    "github.com/ethereum/go-ethereum/common"\n    "github.com/ethereum/go-ethereum/common/hexutil"\n    "github.com/ethereum/go-ethereum/ethclient"\n)\n\n// LogFill ...\ntype LogFill struct {\n    Maker                  common.Address\n    Taker                  common.Address\n    FeeRecipient           common.Address\n    MakerToken             common.Address\n    TakerToken             common.Address\n    FilledMakerTokenAmount *big.Int\n    FilledTakerTokenAmount *big.Int\n    PaidMakerFee           *big.Int\n    PaidTakerFee           *big.Int\n    Tokens                 [32]byte\n    OrderHash              [32]byte\n}\n\n// LogCancel ...\ntype LogCancel struct {\n    Maker                     common.Address\n    FeeRecipient              common.Address\n    MakerToken                common.Address\n    TakerToken                common.Address\n    CancelledMakerTokenAmount *big.Int\n    CancelledTakerTokenAmount *big.Int\n    Tokens                    [32]byte\n    OrderHash                 [32]byte\n}\n\n// LogError ...\ntype LogError struct {\n    ErrorID   uint8\n    OrderHash [32]byte\n}\n\nfunc main() {\n    client, err := ethclient.Dial("https://cloudflare-eth.com")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // 0x Protocol Exchange smart contract address\n    contractAddress := common.HexToAddress("0x12459C951127e0c374FF9105DdA097662A027093")\n    query := ethereum.FilterQuery{\n        FromBlock: big.NewInt(6383482),\n        ToBlock:   big.NewInt(6383488),\n        Addresses: []common.Address{\n            contractAddress,\n        },\n    }\n\n    logs, err := client.FilterLogs(context.Background(), query)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    contractAbi, err := abi.JSON(strings.NewReader(string(exchange.ExchangeABI)))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // NOTE: keccak256("LogFill(address,address,address,address,address,uint256,uint256,uint256,uint256,bytes32,bytes32)")\n    logFillEvent := common.HexToHash("0d0b9391970d9a25552f37d436d2aae2925e2bfe1b2a923754bada030c498cb3")\n\n    // NOTE: keccak256("LogCancel(address,address,address,address,uint256,uint256,bytes32,bytes32)")\n    logCancelEvent := common.HexToHash("67d66f160bc93d925d05dae1794c90d2d6d6688b29b84ff069398a9b04587131")\n\n    // NOTE: keccak256("LogError(uint8,bytes32)")\n    logErrorEvent := common.HexToHash("36d86c59e00bd73dc19ba3adfe068e4b64ac7e92be35546adeddf1b956a87e90")\n\n    for _, vLog := range logs {\n        fmt.Printf("Log Block Number: %d\\n", vLog.BlockNumber)\n        fmt.Printf("Log Index: %d\\n", vLog.Index)\n\n        switch vLog.Topics[0].Hex() {\n        case logFillEvent.Hex():\n            fmt.Printf("Log Name: LogFill\\n")\n\n            var fillEvent LogFill\n\n            err := contractAbi.Unpack(&fillEvent, "LogFill", vLog.Data)\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            fillEvent.Maker = common.HexToAddress(vLog.Topics[1].Hex())\n            fillEvent.FeeRecipient = common.HexToAddress(vLog.Topics[2].Hex())\n            fillEvent.Tokens = vLog.Topics[3]\n\n            fmt.Printf("Maker: %s\\n", fillEvent.Maker.Hex())\n            fmt.Printf("Taker: %s\\n", fillEvent.Taker.Hex())\n            fmt.Printf("Fee Recipient: %s\\n", fillEvent.FeeRecipient.Hex())\n            fmt.Printf("Maker Token: %s\\n", fillEvent.MakerToken.Hex())\n            fmt.Printf("Taker Token: %s\\n", fillEvent.TakerToken.Hex())\n            fmt.Printf("Filled Maker Token Amount: %s\\n", fillEvent.FilledMakerTokenAmount.String())\n            fmt.Printf("Filled Taker Token Amount: %s\\n", fillEvent.FilledTakerTokenAmount.String())\n            fmt.Printf("Paid Maker Fee: %s\\n", fillEvent.PaidMakerFee.String())\n            fmt.Printf("Paid Taker Fee: %s\\n", fillEvent.PaidTakerFee.String())\n            fmt.Printf("Tokens: %s\\n", hexutil.Encode(fillEvent.Tokens[:]))\n            fmt.Printf("Order Hash: %s\\n", hexutil.Encode(fillEvent.OrderHash[:]))\n\n        case logCancelEvent.Hex():\n            fmt.Printf("Log Name: LogCancel\\n")\n\n            var cancelEvent LogCancel\n\n            err := contractAbi.Unpack(&cancelEvent, "LogCancel", vLog.Data)\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            cancelEvent.Maker = common.HexToAddress(vLog.Topics[1].Hex())\n            cancelEvent.FeeRecipient = common.HexToAddress(vLog.Topics[2].Hex())\n            cancelEvent.Tokens = vLog.Topics[3]\n\n            fmt.Printf("Maker: %s\\n", cancelEvent.Maker.Hex())\n            fmt.Printf("Fee Recipient: %s\\n", cancelEvent.FeeRecipient.Hex())\n            fmt.Printf("Maker Token: %s\\n", cancelEvent.MakerToken.Hex())\n            fmt.Printf("Taker Token: %s\\n", cancelEvent.TakerToken.Hex())\n            fmt.Printf("Cancelled Maker Token Amount: %s\\n", cancelEvent.CancelledMakerTokenAmount.String())\n            fmt.Printf("Cancelled Taker Token Amount: %s\\n", cancelEvent.CancelledTakerTokenAmount.String())\n            fmt.Printf("Tokens: %s\\n", hexutil.Encode(cancelEvent.Tokens[:]))\n            fmt.Printf("Order Hash: %s\\n", hexutil.Encode(cancelEvent.OrderHash[:]))\n\n        case logErrorEvent.Hex():\n            fmt.Printf("Log Name: LogError\\n")\n\n            errorID, err := strconv.ParseInt(vLog.Topics[1].Hex(), 16, 64)\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            errorEvent := &LogError{\n                ErrorID:   uint8(errorID),\n                OrderHash: vLog.Topics[2],\n            }\n\n            fmt.Printf("Error ID: %d\\n", errorEvent.ErrorID)\n            fmt.Printf("Order Hash: %s\\n", hexutil.Encode(errorEvent.OrderHash[:]))\n        }\n\n        fmt.Printf("\\n\\n")\n    }\n}\n')),(0,a.kt)("p",null,"\u8fd9\u4e9b\u793a\u4f8b\u4f7f\u7528\u7684solc\u7248\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ solc --version\n0.4.11+commit.68ef5810.Emscripten.clang\n")))}g.isMDXComponent=!0}}]);